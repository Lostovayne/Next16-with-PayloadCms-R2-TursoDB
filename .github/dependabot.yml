# Configuración de Dependabot para actualizaciones automáticas de dependencias
# Documentación: https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/configuration-options-for-the-dependabot.yml-file

version: 2
updates:
  # Actualizaciones de pnpm (package.json)
  - package-ecosystem: 'npm'
    directory: '/'
    schedule:
      interval: 'weekly'
      day: 'monday'
      time: '09:00'
      timezone: 'America/New_York'

    # Estrategia de versionado
    # patch: actualizaciones de parches (1.0.x)
    # minor: actualizaciones menores (1.x.0)
    versioning-strategy: increase-if-necessary

    # AGRUPACIÓN MEJORADA - Reduce el número de PRs
    groups:
      # Grupo 1: Payload CMS (TODO junto en 1 PR - CRÍTICO: todas las versiones deben coincidir)
      payload-ecosystem:
        patterns:
          - '@payloadcms/*'
          - 'payload'
        # Incluir TODOS los tipos de actualización (major, minor, patch)
        # para que Payload se actualice siempre completo
        update-types:
          - 'major'
          - 'minor'
          - 'patch'

      # Grupo 2: React y Next.js (TODO junto en 1 PR)
      react-nextjs:
        patterns:
          - 'react'
          - 'react-dom'
          - 'next'
          - '@types/react'
          - '@types/react-dom'
        update-types:
          - 'minor'
          - 'patch'

      # Grupo 3: AWS SDK (TODO junto en 1 PR)
      aws-sdk:
        patterns:
          - '@aws-sdk/*'
        update-types:
          - 'minor'
          - 'patch'

      # Grupo 4: Database (TODO junto en 1 PR)
      database:
        patterns:
          - 'drizzle-kit'
          - '@libsql/*'
        update-types:
          - 'minor'
          - 'patch'

      # Grupo 5: Testing (TODO junto en 1 PR)
      testing:
        patterns:
          - 'vitest'
          - 'playwright'
          - '@playwright/*'
          - '@vitejs/*'
          - '@testing-library/*'
          - 'playwright-core'
          - 'jsdom'
        update-types:
          - 'minor'
          - 'patch'

      # Grupo 6: Linting y formato (TODO junto en 1 PR)
      linting:
        patterns:
          - 'eslint'
          - 'eslint-*'
          - 'prettier'
          - '@eslint/*'
        update-types:
          - 'minor'
          - 'patch'

      # Grupo 7: TypeScript (TODO junto en 1 PR)
      typescript:
        patterns:
          - 'typescript'
          - '@types/*'
        update-types:
          - 'minor'
          - 'patch'

      # Grupo 8: Otras dependencias de producción (TODO junto en 1 PR)
      production-dependencies:
        dependency-type: 'production'
        exclude-patterns:
          - '@payloadcms/*'
          - 'payload'
          - 'react'
          - 'react-dom'
          - 'next'
          - '@aws-sdk/*'
          - 'drizzle-kit'
          - '@libsql/*'
        update-types:
          - 'minor'
          - 'patch'

      # Grupo 9: Otras dependencias de desarrollo (TODO junto en 1 PR)
      development-dependencies:
        dependency-type: 'development'
        exclude-patterns:
          - 'vitest'
          - 'playwright'
          - '@playwright/*'
          - 'eslint'
          - 'eslint-*'
          - 'prettier'
          - '@eslint/*'
          - 'typescript'
          - '@types/*'
        update-types:
          - 'minor'
          - 'patch'

    # Límite de PRs simultáneos (reducido para evitar spam)
    open-pull-requests-limit: 5

    # NO USAR LABELS (eliminar hasta que las crees manualmente)
    # labels:
    #   - 'dependencies'
    #   - 'automated'

    # Commit message personalizados
    commit-message:
      prefix: 'chore'
      prefix-development: 'chore'
      include: 'scope'

    # Bloquear actualizaciones major para la mayoría de paquetes
    # EXCEPCIÓN: Payload CMS puede actualizarse a major (todas las versiones deben coincidir)
    ignore:
      # React ecosystem - solo minor/patch
      - dependency-name: 'react'
        update-types: ['version-update:semver-major']
      - dependency-name: 'react-dom'
        update-types: ['version-update:semver-major']
      - dependency-name: 'next'
        update-types: ['version-update:semver-major']

      # Database - solo minor/patch
      - dependency-name: 'drizzle-kit'
        update-types: ['version-update:semver-major']

      # AWS SDK - solo minor/patch
      - dependency-name: '@aws-sdk/*'
        update-types: ['version-update:semver-major']

      # Testing - solo minor/patch
      - dependency-name: 'vitest'
        update-types: ['version-update:semver-major']
      - dependency-name: 'playwright'
        update-types: ['version-update:semver-major']
      - dependency-name: '@playwright/*'
        update-types: ['version-update:semver-major']

      # TypeScript - solo minor/patch
      - dependency-name: 'typescript'
        update-types: ['version-update:semver-major']

      # Build tools - solo minor/patch
      - dependency-name: 'sharp'
        update-types: ['version-update:semver-major']

      # Linting - solo minor/patch
      - dependency-name: 'eslint'
        update-types: ['version-update:semver-major']
      - dependency-name: 'prettier'
        update-types: ['version-update:semver-major']

      # NOTA: @payloadcms/* y payload NO están en la lista de ignore
      # Esto permite que se actualicen a major versions cuando sea necesario

    # Rebase automático de PRs
    rebase-strategy: 'auto'

  # Actualizaciones de GitHub Actions
  - package-ecosystem: 'github-actions'
    directory: '/'
    schedule:
      interval: 'weekly'
      day: 'monday'
      time: '09:00'
      timezone: 'America/New_York'

    # Agrupar todas las actions juntas
    groups:
      github-actions:
        patterns:
          - '*'
        update-types:
          - 'minor'
          - 'patch'

    # NO USAR LABELS
    # labels:
    #   - 'dependencies'
    #   - 'github-actions'
    #   - 'automated'

    commit-message:
      prefix: 'ci'
      include: 'scope'

    open-pull-requests-limit: 2

    # Solo actualizaciones menores y patches para actions
    ignore:
      - dependency-name: '*'
        update-types: ['version-update:semver-major']

  # Actualizaciones de Docker (si usas Docker)
  - package-ecosystem: 'docker'
    directory: '/'
    schedule:
      interval: 'weekly'
      day: 'monday'
      time: '10:00'
      timezone: 'America/New_York'

    # Agrupar todas las imágenes Docker juntas
    groups:
      docker-images:
        patterns:
          - '*'
        update-types:
          - 'minor'
          - 'patch'

    # NO USAR LABELS
    # labels:
    #   - 'dependencies'
    #   - 'docker'
    #   - 'automated'

    commit-message:
      prefix: 'chore'
      include: 'scope'

    open-pull-requests-limit: 1

    # Solo actualizaciones menores para Docker
    ignore:
      - dependency-name: '*'
        update-types: ['version-update:semver-major']
